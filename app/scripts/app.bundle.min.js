/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/../app/";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	/**
	 * Created by 郑树聪 on 2016/2/14.
	 */

	//'use strict';

	var $config = __webpack_require__(1);

	/**
	 * 处理用户认证
	 */
	$config.musicApp.factory('AuthenticationService', function(){

	    var auth = {
	        isLogged: false
	    };
	    return auth;
	});

	$config.musicApp.factory('TokenInterceptor', function ($q, $window, AuthenticationService) {
	    return {
	        request: function (config) {
	            config.headers = config.headers || {};
	            if ($window.sessionStorage.token) {
	                config.headers.Authorization = 'Bearer ' + $window.sessionStorage.token;
	            }
	            return config;
	        },

	        response: function (response) {
	            return response || $q.when(response);
	        }
	    };
	});

	$config.musicApp.config(function ($httpProvider) {
	    $httpProvider.interceptors.push('TokenInterceptor');
	});

	$config.musicApp.config(['$routeProvider', function($routeProvider) {
	    $routeProvider
	        // 首页
	        .when('/', {
	            templateUrl: 'app/views/home.html',
	            controller: 'UserCtrl',
	            access: { requiredLogin: false }
	        })
	        // 后台管理首页
	        .when('/admin', {
	            templateUrl: 'app/views/admin.html',
	            controller: 'adminCtrl',
	            access: { requiredLogin: true }
	        })
	        // 登录页
	        .when("/login", {
	            templateUrl: 'app/views/login.html',
	            controller: 'UserCtrl',
	            access: { requiredLogin: false }
	        })
	        .when('/register', {
	            templateUrl: 'app/views/register.html',
	            controller: 'UserCtrl',
	            access: { requiredLogin: false }
	        })
	        .otherwise({
	            redirectTo: "/",
	            access: { requiredLogin: false }
	        });

	}]);

	$config.musicApp.run(function($rootScope, $location, $window, AuthenticationService) {
	    $rootScope.$on("$routeChangeStart", function(event, nextRoute, currentRoute) {
	        //redirect only if both isLogged is false and no token is set
	        if (nextRoute !== null && nextRoute.access !== null && nextRoute.access.requiredLogin &&
	            !AuthenticationService.isLogged && !$window.sessionStorage.token) {

	            $location.path("/");
	        }
	    });
	});

	// 加载angular控制器
	__webpack_require__(2);

	module.exports = $config.musicApp;


/***/ },
/* 1 */
/***/ function(module, exports) {

	/**
	 * Angular项目前端配置
	 * Created by 郑树聪 on 2016/2/28.
	 */

	module.exports = {
	    musicApp: angular.module('musicApp', ['ngRoute', 'ui.bootstrap']),
	    base_url: 'http://localhost:3000/',
	    api: {
	        login: 'api/login',
	        register: 'api/register'
	    }
	};

/***/ },
/* 2 */
/***/ function(module, exports, __webpack_require__) {

	/**
	 * 用户操作控制器,登录/登出
	 * Created by 郑树聪 on 2016/2/17.
	 */
	var $config = __webpack_require__(1);

	$config.musicApp.factory('UserService', ['$http', function($http){
	    return {
	        // 注册服务
	        register: function(username, email, password){

	            var url = $config.base_url + $config.api.register;
	            return $http.post(url, {
	                username: username,
	                email: email,
	                password: password
	            });
	        },
	        // 登录服务
	        login: function(email, password) {

	            var url = $config.base_url + $config.api.login;
	            return $http.post(url, {
	                email: email,
	                password: password
	            });
	        },
	        // 登出服务
	        logout: function() {

	        }
	    };
	}]).controller('UserCtrl', ['$scope', '$location', '$window', 'UserService', 'AuthenticationService',
	    function($scope, $location, $window, UserService, AuthenticationService){

	        // 注册事件
	        $scope.register = function(username, email, password1, password2) {
	            if(!username){
	                $scope.username = '请输入用户名';
	            } else if(!email){
	                $scope.message = '请输入邮箱';
	            } else if(!password1){
	                $scope.message = '请输入密码';
	            } else if(password1 !== password2){
	                $scope.message = '两次密码不一致';
	            } else{
	                $scope.disabled = true;   //防止表单重复提交
	                $scope.message = false;
	                UserService.register(username, email, password1).success(function(data, status, headers, config){
	                    if(data.success) {
	                        $scope.disabled = false;
	                        $location.path('/login');
	                    } else {
	                        console.log(data.msg);
	                        $scope.message = data.msg;
	                    }
	                })
	                .error(function(data, status, headers, config){
	                    $scope.message = "加载失败，请重新再试";
	                    $scope.disabled = false;
	                });
	            }
	        };

	        // 登录事件
	        $scope.login = function(email, password) {
	            if (typeof email !== 'undefined' && typeof password !== 'undefined') {

	                UserService.login(email, password).success(function(data) {
	                    AuthenticationService.isLogged = true;
	                    $window.sessionStorage.token = data.token;
	                    $location.path('/');
	                }).error(function(status, data) {
	                    console.log(status);
	                    console.log(data);
	                    delete $window.sessionStorage.token;
	                });
	            } else if(typeof email === 'undefined') {
	                //$scope.emailTooltipIsOpen = !$scope.emailTooltipIsOpen;
	                //$scope.message = '邮箱不能为空';
	            } else if(typeof password === 'undefined') {

	            }
	        };

	        // 登出事件
	        $scope.logout = function logout() {
	            if (AuthenticationService.isLogged) {
	                AuthenticationService.isLogged = false;
	                delete $window.sessionStorage.token;
	                $location.path('/');
	            }
	        };
	    }
	]);


/***/ }
/******/ ]);